<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Iuran & Kas Guru - Lengkap</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .card .value.positive {
            color: #28a745;
        }

        .card .value.negative {
            color: #dc3545;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .section h2 {
            color: #333;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5ee;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-block {
            width: 100%;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .transaction-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .transaction-item:hover {
            background-color: #f8f9fa;
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-name {
            font-weight: 600;
            color: #333;
        }

        .transaction-description {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .transaction-date {
            font-size: 0.9rem;
            color: #666;
        }

        .transaction-category {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .transaction-amount {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .transaction-income {
            color: #28a745;
        }

        .transaction-expense {
            color: #dc3545;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }

        .summary {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .category-tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 2px;
        }

        .expense-analysis {
            margin-top: 30px;
        }

        .category-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .category-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .category-name {
            font-weight: 600;
            color: #333;
        }

        .category-amount {
            color: #dc3545;
            font-weight: 600;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e5ee;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .expense-details {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-top: 5px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Kalkulator Iuran & Kas Guru - Lengkap</h1>
            <p>Kelola iuran, pengeluaran, dan analisis penggunaan dana dengan transparan</p>
        </div>

        <div class="dashboard">
            <div class="card">
                <h3>Total Kas Saat Ini</h3>
                <div class="value" id="totalCash">Rp 0</div>
            </div>
            <div class="card">
                <h3>Total Iuran Bulan Ini</h3>
                <div class="value" id="totalContribution">Rp 0</div>
            </div>
            <div class="card">
                <h3>Total Pengeluaran</h3>
                <div class="value" id="totalExpense">Rp 0</div>
            </div>
            <div class="card">
                <h3>Jumlah Guru</h3>
                <div class="value" id="totalTeachers">0</div>
            </div>
        </div>

        <div class="main-content">
            <div class="section">
                <h2>Kelola Iuran Guru</h2>
                <div id="contributionAlert"></div>
                
                <div class="form-group">
                    <label for="teacherName">Nama Guru:</label>
                    <input type="text" id="teacherName" placeholder="Masukkan nama guru">
                </div>

                <div class="form-group">
                    <label for="contributionAmount">Jumlah Iuran:</label>
                    <input type="number" id="contributionAmount" placeholder="Masukkan jumlah iuran" value="50000">
                </div>

                <div class="form-group">
                    <label for="contributionMonth">Bulan Iuran:</label>
                    <select id="contributionMonth">
                        <option value="1">Januari</option>
                        <option value="2">Februari</option>
                        <option value="3">Maret</option>
                        <option value="4">April</option>
                        <option value="5">Mei</option>
                        <option value="6">Juni</option>
                        <option value="7">Juli</option>
                        <option value="8">Agustus</option>
                        <option value="9">September</option>
                        <option value="10">Oktober</option>
                        <option value="11">November</option>
                        <option value="12">Desember</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="contributionYear">Tahun:</label>
                    <input type="number" id="contributionYear" placeholder="Tahun" value="2024">
                </div>

                <button class="btn btn-block" onclick="addContribution()">Tambah Iuran</button>

                <div class="transaction-list" id="contributionList">
                    <!-- Daftar iuran akan ditampilkan di sini -->
                </div>
            </div>

            <div class="section">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('expenseTab')">Tambah Pengeluaran</div>
                    <div class="tab" onclick="switchTab('analysisTab')">Analisis Pengeluaran</div>
                </div>

                <div id="expenseTab" class="tab-content active">
                    <h2>Kelola Pengeluaran Kas</h2>
                    <div id="expenseAlert"></div>

                    <div class="form-group">
                        <label for="expenseDescription">Keterangan Pengeluaran:</label>
                        <input type="text" id="expenseDescription" placeholder="Contoh: Pembuatan spanduk acara">
                    </div>

                    <div class="form-group">
                        <label for="expenseCategory">Kategori Pengeluaran:</label>
                        <select id="expenseCategory">
                            <option value="acara">Acara & Kegiatan</option>
                            <option value="sarana">Sarana Prasarana</option>
                            <option value="sosial">Bantuan Sosial</option>
                            <option value="operasional">Operasional</option>
                            <option value="konsumsi">Konsumsi</option>
                            <option value="transport">Transportasi</option>
                            <option value="lainnya">Lainnya</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="expenseAmount">Jumlah Pengeluaran:</label>
                        <input type="number" id="expenseAmount" placeholder="Masukkan jumlah pengeluaran">
                    </div>

                    <div class="form-group">
                        <label for="expenseDate">Tanggal Pengeluaran:</label>
                        <input type="date" id="expenseDate">
                    </div>

                    <div class="form-group">
                        <label for="expenseDetails">Detail Penggunaan (Opsional):</label>
                        <textarea id="expenseDetails" placeholder="Tambahkan detail penggunaan dana..." rows="3"></textarea>
                    </div>

                    <button class="btn btn-block" onclick="addExpense()">Tambah Pengeluaran</button>

                    <div class="transaction-list" id="expenseList">
                        <!-- Daftar pengeluaran akan ditampilkan di sini -->
                    </div>

                    <div class="summary">
                        <div class="summary-item">
                            <span>Total Pemasukan:</span>
                            <span id="totalIncomeSummary">Rp 0</span>
                        </div>
                        <div class="summary-item">
                            <span>Total Pengeluaran:</span>
                            <span id="totalExpenseSummary">Rp 0</span>
                        </div>
                        <div class="summary-item">
                            <span>Saldo Akhir:</span>
                            <span id="finalBalance">Rp 0</span>
                        </div>
                    </div>
                </div>

                <div id="analysisTab" class="tab-content">
                    <h2>Analisis Pengeluaran</h2>
                    
                    <div class="expense-analysis">
                        <h3>Breakdown Berdasarkan Kategori</h3>
                        <div class="category-breakdown" id="categoryBreakdown">
                            <!-- Analisis kategori akan ditampilkan di sini -->
                        </div>
                    </div>

                    <div class="expense-analysis">
                        <h3>Riwayat Pengeluaran Detail</h3>
                        <div class="transaction-list" id="detailedExpenseList">
                            <!-- Riwayat detail pengeluaran -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let contributions = JSON.parse(localStorage.getItem('teacherContributions')) || [];
        let expenses = JSON.parse(localStorage.getItem('teacherExpenses')) || [];

        // Kategori pengeluaran dengan warna
        const expenseCategories = {
            'acara': { name: 'Acara & Kegiatan', color: '#007bff', bgColor: '#e3f2fd' },
            'sarana': { name: 'Sarana Prasarana', color: '#28a745', bgColor: '#e8f5e8' },
            'sosial': { name: 'Bantuan Sosial', color: '#ffc107', bgColor: '#fff9e6' },
            'operasional': { name: 'Operasional', color: '#dc3545', bgColor: '#fdeaea' },
            'konsumsi': { name: 'Konsumsi', color: '#6f42c1', bgColor: '#f0e6ff' },
            'transport': { name: 'Transportasi', color: '#fd7e14', bgColor: '#ffe8d9' },
            'lainnya': { name: 'Lainnya', color: '#6c757d', bgColor: '#f8f9fa' }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('expenseDate').valueAsDate = new Date();
            updateDashboard();
            renderContributions();
            renderExpenses();
            renderExpenseAnalysis();
        });

        // Switch tab
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Show alert
        function showAlert(elementId, message, type) {
            const alertDiv = document.getElementById(elementId);
            alertDiv.innerHTML = message;
            alertDiv.className = `alert alert-${type}`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
                alertDiv.className = '';
            }, 3000);
        }

        // Add contribution
        function addContribution() {
            const name = document.getElementById('teacherName').value.trim();
            const amount = parseInt(document.getElementById('contributionAmount').value);
            const month = document.getElementById('contributionMonth').value;
            const year = document.getElementById('contributionYear').value;

            if (!name || !amount || amount <= 0) {
                showAlert('contributionAlert', 'Harap isi semua field dengan benar!', 'error');
                return;
            }

            const contribution = {
                id: Date.now(),
                name: name,
                amount: amount,
                month: month,
                year: year,
                date: new Date().toLocaleDateString('id-ID')
            };

            contributions.push(contribution);
            localStorage.setItem('teacherContributions', JSON.stringify(contributions));
            
            showAlert('contributionAlert', 'Iuran berhasil ditambahkan!', 'success');
            document.getElementById('teacherName').value = '';
            updateDashboard();
            renderContributions();
        }

        // Add expense
        function addExpense() {
            const description = document.getElementById('expenseDescription').value.trim();
            const category = document.getElementById('expenseCategory').value;
            const amount = parseInt(document.getElementById('expenseAmount').value);
            const date = document.getElementById('expenseDate').value;
            const details = document.getElementById('expenseDetails').value.trim();

            if (!description || !amount || amount <= 0 || !date) {
                showAlert('expenseAlert', 'Harap isi semua field dengan benar!', 'error');
                return;
            }

            const expense = {
                id: Date.now(),
                description: description,
                category: category,
                amount: amount,
                date: new Date(date).toLocaleDateString('id-ID'),
                details: details,
                categoryName: expenseCategories[category].name
            };

            expenses.push(expense);
            localStorage.setItem('teacherExpenses', JSON.stringify(expenses));
            
            showAlert('expenseAlert', 'Pengeluaran berhasil ditambahkan!', 'success');
            document.getElementById('expenseDescription').value = '';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDetails').value = '';
            updateDashboard();
            renderExpenses();
            renderExpenseAnalysis();
        }

        // Delete contribution
        function deleteContribution(id) {
            if (confirm('Apakah Anda yakin ingin menghapus iuran ini?')) {
                contributions = contributions.filter(contribution => contribution.id !== id);
                localStorage.setItem('teacherContributions', JSON.stringify(contributions));
                updateDashboard();
                renderContributions();
            }
        }

        // Delete expense
        function deleteExpense(id) {
            if (confirm('Apakah Anda yakin ingin menghapus pengeluaran ini?')) {
                expenses = expenses.filter(expense => expense.id !== id);
                localStorage.setItem('teacherExpenses', JSON.stringify(expenses));
                updateDashboard();
                renderExpenses();
                renderExpenseAnalysis();
            }
        }

        // Render contributions
        function renderContributions() {
            const list = document.getElementById('contributionList');
            list.innerHTML = '';

            if (contributions.length === 0) {
                list.innerHTML = '<div class="transaction-item">Belum ada data iuran</div>';
                return;
            }

            contributions.forEach(contribution => {
                const item = document.createElement('div');
                item.className = 'transaction-item';
                item.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-name">${contribution.name}</div>
                        <div class="transaction-date">${getMonthName(contribution.month)} ${contribution.year}</div>
                    </div>
                    <div class="transaction-amount transaction-income">
                        ${formatCurrency(contribution.amount)}
                    </div>
                    <button class="delete-btn" onclick="deleteContribution(${contribution.id})">Hapus</button>
                `;
                list.appendChild(item);
            });
        }

        // Render expenses
        function renderExpenses() {
            const list = document.getElementById('expenseList');
            list.innerHTML = '';

            if (expenses.length === 0) {
                list.innerHTML = '<div class="transaction-item">Belum ada data pengeluaran</div>';
                return;
            }

            expenses.forEach(expense => {
                const category = expenseCategories[expense.category];
                const item = document.createElement('div');
                item.className = 'transaction-item';
                item.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-name">${expense.description}</div>
                        <div class="transaction-category" style="background-color: ${category.bgColor}; color: ${category.color};">
                            ${category.name}
                        </div>
                        <div class="transaction-date">${expense.date}</div>
                        ${expense.details ? `<div class="expense-details">${expense.details}</div>` : ''}
                    </div>
                    <div class="transaction-amount transaction-expense">
                        ${formatCurrency(expense.amount)}
                    </div>
                    <button class="delete-btn" onclick="deleteExpense(${expense.id})">Hapus</button>
                `;
                list.appendChild(item);
            });
        }

        // Render expense analysis
        function renderExpenseAnalysis() {
            const breakdown = document.getElementById('categoryBreakdown');
            const detailedList = document.getElementById('detailedExpenseList');
            
            breakdown.innerHTML = '';
            detailedList.innerHTML = '';

            if (expenses.length === 0) {
                breakdown.innerHTML = '<div class="category-item">Belum ada data pengeluaran</div>';
                detailedList.innerHTML = '<div class="transaction-item">Belum ada data pengeluaran</div>';
                return;
            }

            // Calculate category totals
            const categoryTotals = {};
            Object.keys(expenseCategories).forEach(category => {
                categoryTotals[category] = 0;
            });

            expenses.forEach(expense => {
                categoryTotals[expense.category] += expense.amount;
            });

            // Render category breakdown
            Object.keys(categoryTotals).forEach(category => {
                if (categoryTotals[category] > 0) {
                    const categoryInfo = expenseCategories[category];
                    const percentage = ((categoryTotals[category] / expenses.reduce((sum, e) => sum + e.amount, 0)) * 100).toFixed(1);
                    
                    const item = document.createElement('div');
                    item.className = 'category-item';
                    item.innerHTML = `
                        <div class="category-name">${categoryInfo.name}</div>
                        <div class="category-amount">${formatCurrency(categoryTotals[category])}</div>
                        <div style="color: #666; font-size: 0.9rem;">${percentage}% dari total pengeluaran</div>
                    `;
                    breakdown.appendChild(item);
                }
            });

            // Render detailed expense list for analysis
            expenses.forEach(expense => {
                const category = expenseCategories[expense.category];
                const item = document.createElement('div');
                item.className = 'transaction-item';
                item.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-name">${expense.description}</div>
                        <div class="transaction-category" style="background-color: ${category.bgColor}; color: ${category.color};">
                            ${category.name}
                        </div>
                        <div class="transaction-date">${expense.date}</div>
                        ${expense.details ? `<div class="expense-details"><strong>Detail:</strong> ${expense.details}</div>` : ''}
                    </div>
                    <div class="transaction-amount transaction-expense">
                        ${formatCurrency(expense.amount)}
                    </div>
                `;
                detailedList.appendChild(item);
            });
        }

        // Update dashboard
        function updateDashboard() {
            const totalContribution = contributions.reduce((sum, item) => sum + item.amount, 0);
            const totalExpense = expenses.reduce((sum, item) => sum + item.amount, 0);
            const totalCash = totalContribution - totalExpense;
            const uniqueTeachers = new Set(contributions.map(item => item.name)).size;

            document.getElementById('totalCash').textContent = formatCurrency(totalCash);
            document.getElementById('totalContribution').textContent = formatCurrency(totalContribution);
            document.getElementById('totalExpense').textContent = formatCurrency(totalExpense);
            document.getElementById('totalTeachers').textContent = uniqueTeachers;

            // Update summary
            document.getElementById('totalIncomeSummary').textContent = formatCurrency(totalContribution);
            document.getElementById('totalExpenseSummary').textContent = formatCurrency(totalExpense);
            document.getElementById('finalBalance').textContent = formatCurrency(totalCash);

            // Add color classes
            document.getElementById('totalCash').className = `value ${totalCash >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('finalBalance').className = `summary-item ${totalCash >= 0 ? 'positive' : 'negative'}`;
        }

        // Get month name
        function getMonthName(monthNumber) {
            const months = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
            ];
            return months[parseInt(monthNumber) - 1] || '';
        }
    </script>
</body>
</html>